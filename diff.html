<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <script src="js/diff2html.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/diff2html.min.css">
  <style type="text/css">

    body {
        background-color: white;
        padding:0px;
        margin:0px;
    }

  </style>
</head>
<body>

  <div class="main">
   <div id="commit">
     commit message:<br>
     <textarea id="commitMsg" rows=5 cols=80></textarea>
     <button id="commitButton">commit</button>
   </div>
   <div id="html" class="html">
     <pre id="git"></pre>  
   </div>
  </div>

<script type="text/javascript">


window.onerror = function(e) {
    alert(e);
}

function escapeHtml(unsafe) {
    return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
 }


document.addEventListener("DOMContentLoaded", function(e)
{
    let View = {

        setPlainText : function( output) {
            if(!output) {
                output = "";
            }
            document.getElementById("commit").style.display = "none";
            document.getElementById("html").innerHTML = "<pre>"  + escapeHtml(output) + "</pre>";
        },

        setDiff : function( output) {

            var diffHtml = window.Diff2Html.html( output, {
                drawFileList: true,
                matching: 'lines',
//                outputFormat: 'side-by-side',
            });

            document.getElementById("commit").style.display = "none";
            document.getElementById("html").innerHTML = diffHtml;
        },

        setCommit : function( output) {

          var diffHtml = window.Diff2Html.html( output, {
            drawFileList: true,
            matching: 'lines',
            //                outputFormat: 'side-by-side',
          });

          document.getElementById("html").innerHTML = diffHtml;
          document.getElementById("commit").style.display = "block";
        },

        onCommit : function() {

          let msg = document.getElementById("commitMsg").value;
          WebKit.Python.onSubmitCommit(msg);
        }

    };


    WebKit.bind(View);

    WebKit.Python.onDocumentLoad();
    document.getElementById("commitButton").onclick=View.onCommit;
});

</script>
</body>
</html>

